package model;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class DbInventory{
    public static void main(String[] args) throws Exception {
		getConnection();
	}
    static Connection con;
    
    public DbInventory(){
        try{
			getConnection();
		}
		catch(Exception e){
			e.printStackTrace();
		}
    }

    public static Connection getConnection() throws Exception{
        try {
            // credentials to access database
            String driver = "com.mysql.cj.jdbc.Driver";
            String url = "jdbc:mysql://127.0.0.1:3306/3311project";//dbinventory
            String username = "root";
            String password = "root1234";// 28112001
            
            Class.forName(driver);
            con = DriverManager.getConnection(url,username,password);
            System.out.println("Connected to database!");
            return con;
        }
        catch(Exception e){
            System.out.println(e.getMessage());
        }
        
        return null;
        
    }

    /**
     * required methods to be implemented
     * 1-getIngredient
     * 2-searchIngredient
     * 3-getInstance
     * 4-checkQuantity
     */

     /**
      * querry- select quantity
      from INGREDIENTS 
      where ingredient_name = 'ingredientName';
      * table - INGREDIENTS 
      */
      public boolean getIngredient(String ingredientName,int amount){
        try{
        Statement st = con.createStatement();
        String querry = "SELECT quantity FROM inventory WHERE ingredient_name = '"+ingredientName+"';";
        ResultSet rs = st.executeQuery(querry);
         if(rs.next()){
            int currentQuantity = rs.getInt("quantity");
            if(currentQuantity >= amount){
                int newQuantity = currentQuantity - amount;
                Statement stu = con.createStatement();
			    String command = "UPDATE INGREDIENTS SET quantity = '" + quantity + "' WHERE ingredient_name = '" + name + "';";
                int updatedRows = stu.executeUpdate(command);
                if(updatedRows>0){
                    return true;
                }}}}
         catch(Exception e) {
				e.printStackTrace();
                System.out.println("Failed to get ingredient or error connecting database");
			}
            return false;
      }
    /**
     * checkQuantity 
     * querry- select quantity
      from INGREDIENTS 
      where ingredient_name = 'ingredientName';
     */
    
     public int checkQuantity(String ingredientName){
        int qu = 0;
        try{
            Statement st = con.createStatement();
            String querry = "SELECT quantity FROM inventory WHERE ingredient_name = '"+ingredientName+"';";
            ResultSet rs = st.executeQuery(querry);
            if(rs.next()){
                qu = rs.getInt("quantity")
            }
        }
        catch(Exception e) {
            e.printStackTrace();
            System.out.println("Failed to check quantity or error connecting database");
        }
        return qu;
     }

     /**
      * searchIngredient
      querry- select quantity
      from INGREDIENTS 
      where ingredient_name = 'ingredientName';
      */
      public boolean searchIngredient(String ingredientName){
        boolean flag = false;
        try {
            Statement st = con.createStatement();
            String querry = "SELECT quantity FROM inventory WHERE ingredient_name = '"+ingredientName+"';";
            ResultSet rs = st.executeQuery(querry);
            if(rs.next() && rs.getInt("quantity")>0){
                flag = true;
            }
        }
        catch(Exception e) {
            e.printStackTrace();
            System.out.println("Failed to search or error connecting database");
        }
        return flag;
      }
}